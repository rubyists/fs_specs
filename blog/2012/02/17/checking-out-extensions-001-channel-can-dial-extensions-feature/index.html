
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Checking Out Extensions - 001_channel_can_dial_extensions feature - FreeSWITCH And FreeSWITCHeR Ruby Library</title>
  <meta name="author" content="Deryl R. Doucette">

  
  <meta name="description" content="Core Feature - 001_channel_can_dial_extensions.feature As I said in the previous article, there is some overlap here. Note that I will be referring &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rubyists.github.com/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature">
  <link href="/fs_specs/favicon.png" rel="icon">
  <link href="/fs_specs/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/fs_specs/javascripts/modernizr-2.0.js"></script>
  <script src="/fs_specs/javascripts/ender.js"></script>
  <script src="/fs_specs/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/fs_specs/atom.xml" rel="alternate" title="FreeSWITCH And FreeSWITCHeR Ruby Library" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h2><a href="/fs_specs/">FreeSWITCH And FreeSWITCHeR Ruby Library</a></h2>
  
  <h4>{color:white}A Project for testing FreeSWITCH</h4>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/fs_specs/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rubyists.github.com/fs_specs" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/fs_specs/">Blog</a></li>
  <li><a href="/fs_specs/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h2 class="entry-title">Checking Out Extensions - 001_channel_can_dial_extensions Feature</h2>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-17T13:53:00-05:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>Core Feature - <a href="https://github.com/rubyists/fs_specs/blob/master/features/001_channel_can_dial_extensions.feature">001_channel_can_dial_extensions.feature</a></h3>

<p>  As I said in the previous article, there is some overlap here. Note that I will be referring to features by their ordering number e.g 000. 000 also dials an extension, but in this feature we wanted to specifically isolate, and focus on, that distinct capability of dialling extensions.</p>

<p>  Here is the Feature itself. Remember, this is a testing framework targeting FreeSWITCH. So, we drive all of our actual code through the tests. We, in this instance, are using Cucumber to drive our entire framework so we start in the Feature itself.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    Feature: A channel can dial an extension</span>
</span><span class='line'>
</span><span class='line'><span class="nf"> Once a UserAgent (X-Lite, PolyCom, another FS) can successfully connect to freeswitch, that UserAgent should be able to place a call to any known extension. The UserAgent should be connected to that extension. If that extension can not be reached, or the extension is not known, then the UserAgent should be notified of both the fact of the failure, and the type of the failure.</span>
</span><span class='line'>
</span><span class='line'><span class="nf"> </span><span class="k">Background:</span><span class="nf"></span>
</span><span class='line'><span class="nf">   Given I have 2 servers named blackbird.rubyists.com and tigershark.rubyists.com</span>
</span><span class='line'><span class="nf">   And blackbird.rubyists.com is accessible via the Event Socket</span>
</span><span class='line'>
</span><span class='line'><span class="nf">   Scenario:</span>
</span><span class='line'><span class="nf">     When I dial extension “1000” on tigershark.rubyists.com</span>
</span><span class='line'><span class="nf">     Then I should be connected to that extension</span>
</span><span class='line'><span class="nf">     And I should be able to terminate the call</span>
</span><span class='line'>
</span><span class='line'><span class="nf">   Scenario:</span>
</span><span class='line'><span class="nf">     When I dial unknown extension “1020”</span>
</span><span class='line'><span class="nf">     Then I should be notified the call failed</span>
</span><span class='line'><span class="nf">     And I should receive call failure type “NO_USER_RESPONSE”</span>
</span></code></pre></td></tr></table></div></figure>


<p>  You can see we’ve defined the Feature title explaining what we’re doing. Immediately after we’ve added a deeper explanation of what we’re trying to do. These expanded comments do actually help in the documentation, so I’ll be using them quite a bit going forward. Feel free to correct my technical orderings or something I’ve totally not grokked!</p>

<p>  As mentioned previously, the Background will be the same for every test going forward as that block defines, and creates, the actual EventSockets we’ll be working with in each Feature set. In this instance we’re sending information over the socket using blackbird to talk to tigershark here. Only when the entire Feature has finished will it be torn down.</p>

<p>  Our first Scenario in the Feature dials a specific extension, ‘1000’, shooting the request to freeswitch tigershark, which again, is the system we’re testing. This is done by the following step definition:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">/^I dial extension “([^”]*)” on ([\w.]+)$/ do |known_extension, server|</span>
</span><span class='line'><span class="nf">   orig = </span><span class="nt">@sock2.originate(target:</span><span class="nf"> ‘sofia/external/%s</span><span class="nt">@%s’</span><span class="nf"> % [known_extension, </span><span class="nt">@server2],</span><span class="nf"> endpoint:</span>
</span><span class='line'><span class="nf">                                            “&amp;transfer(‘</span><span class="s">3000</span><span class="nf"> XML default’)”)</span>
</span><span class='line'><span class="nf">   orig.should_not be_nil</span>
</span><span class='line'><span class="nf">   </span><span class="nt">@resp</span><span class="nf"> = orig.run(:api)</span>
</span><span class='line'><span class="nf">   fail “Response does not contain OK” unless (</span><span class="nt">@resp[“body”].match</span><span class="nf"> /^\+OK \w{</span><span class="s">8</span><span class="nf">}-(?:\w{</span><span class="s">4</span><span class="nf">}-){</span><span class="s">3</span><span class="nf">}\w{</span><span class="s">12</span><span class="nf">}$/)</span>
</span><span class='line'><span class="nf"> end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  We pass originate() the extension we’re trying to hit through the captured step variable to known_extension and using that to populate which extension we want, and we immediately transfer it to extension 3000 in the default XML dial plan, which is a Conference extension. We then immediately check that this took place by testing orig is not nil. It will only be nil if the originate call failed. We double check by checking the response body for +OK, as seen in the .match() statement’s regular expression. If it doesn’t match, we hard fail the test.</p>

<p>  We passed, good. Its on to the next step which is verifying that we were, in fact, connected to that extension. That is accomplished through the step definition here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">/^I should be connected to that extension$/ do</span>
</span><span class='line'><span class="nf">   message, </span><span class="nt">@uuid</span><span class="nf"> = </span><span class="nt">@resp[&quot;body&quot;].split(&quot;</span><span class="nf"> &quot;</span><span class="s">)</span>
</span><span class='line'><span class="s">    fail </span><span class="nf">&quot;No UUID found&quot;</span><span class="s"> unless message == &#39;+OK&#39;</span>
</span><span class='line'><span class="s">  end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  In this snippet, we split up the returned response body on spaces, and then set both @uuid which will be used further along in the Feature set, and message. Finally, because we know we won’t get a uuid unless we got a valid response back, we check that message equals +OK. Now we know that @uuid is populated correctly without checking it directly. For stricter checking, we might even want to revisit that and add an explicit check on @uuid.</p>

<p>  We’re all done with this Scenario, except for one thing. We need to terminate the call itself, if for no other reason than to show we can from within the tests. That is accomplished via:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">/^I should be able to terminate the call$/ do</span>
</span><span class='line'><span class="nf">   </span><span class="nt">@uuid.should_not</span><span class="nf"> be_nil</span>
</span><span class='line'><span class="nf">   resp = </span><span class="nt">@sock2.kill(@uuid).run(:api)</span><span class="nf"></span>
</span><span class='line'><span class="nf">   resp[“body”].should match(/^\+OK/)</span>
</span><span class='line'><span class="nf">   </span><span class="s">30.</span><span class="nf">times do</span>
</span><span class='line'><span class="nf">     sleep </span><span class="s">0.1</span><span class="nf"></span>
</span><span class='line'><span class="nf">     break unless </span><span class="nt">@sock2.calls.run.detect</span><span class="nf"> {</span><span class="k"> |</span><span class="s">c</span><span class="k">|</span><span class="s"> c.uuid == @uuid }</span>
</span><span class='line'><span class="s">    end</span>
</span><span class='line'><span class="s">    </span><span class="c"># Make sure there are no calls left still dangling</span><span class="s"></span>
</span><span class='line'><span class="s">    @sock2.calls.run.detect {</span><span class="k"> |</span><span class="s">c</span><span class="k">|</span><span class="s"> c.uuid == @uuid }.should be_nil</span>
</span><span class='line'><span class="s">  end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Here, we check that @uuid set in the previous step survived into this one and that its not nil. That would be bad! Since we have a valid @uuid, we pass that to the socket and call kill() using the synchronous API call. We do this so that it doesn’t get backgrounded on us, and we get an actual response back. That leads us right into the next line which checks the response body for +OK again.</p>

<p>  Next, for the count of 30 seconds we sleep for 0.1s calling detect on the uuid so we can see when it disappears. When it disappears from the call list on tigershark, we break out of the loop. We use 0.1 so we can exit the fastest possible out of the loop once we know the call has been torn down and destroyed. And just to be sure, just before we exit the step all together, we check once more via detect on our way out the door.</p>

<p>  This moves us into our next Scenario where we check to see what happens when we attempt to call an extension that isn’t configured, or otherwise doesn’t exist. The snippets for that are as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">/^I dial unknown extension “([^”]*)”$/ do | unknown_extension|</span>
</span><span class='line'><span class="nf">   orig = </span><span class="nt">@sock2.originate(target:</span><span class="nf"> ‘sofia/external/%s</span><span class="nt">@%s’</span><span class="nf"> % [unknown_extension, </span><span class="nt">@server2],</span><span class="nf"></span>
</span><span class='line'><span class="nf">   endpoint: “&amp;transfer(‘</span><span class="s">3000</span><span class="nf"> XML default’)”)</span>
</span><span class='line'><span class="nf">   </span><span class="nt">@resp</span><span class="nf"> = orig.run(:api)</span>
</span><span class='line'><span class="nf">   </span><span class="nt">@resp[“body”].should</span><span class="nf"> match(/^-ERR/)</span>
</span><span class='line'><span class="nf"> end</span>
</span><span class='line'>
</span><span class='line'><span class="nf"> </span><span class="k">Then </span><span class="nf">/^I should be notified the call failed$/ do</span>
</span><span class='line'><span class="nf">   status, </span><span class="nt">@message</span><span class="nf"> = </span><span class="nt">@resp[“body”].split(“</span><span class="nf"> “)</span>
</span><span class='line'><span class="nf">   status.should match(‘-ERR’)</span>
</span><span class='line'><span class="nf"> end</span>
</span><span class='line'>
</span><span class='line'><span class="nf"> </span><span class="k">Then </span><span class="nf">/^I should receive call failure type “([^”]*)”$/ do |failure_type|</span>
</span><span class='line'><span class="nf">   </span><span class="nt">@message.should</span><span class="nf"> match(“</span><span class="c">#{failure_type}”)</span><span class="nf"></span>
</span><span class='line'><span class="nf"> end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Running fairly quickly through the steps, we reuse the guts of When I dial extension here because we have to do the same thing as we did in that step, but in this case it will be used in the exact opposite. Same steps opposite results, as intended, to show both states: Success, and Failure. Here you can see that we check for -ERR rather than +OK in the other step for both.</p>

<p>  Now, we again parse message here, in which case we look for the specific failure type that was returned. In this instance the expected return type for a failed call is NO_USER_RESPONSE. I did that really fast run-through because its the same as for dialling a known extension, except in the negative.</p>

<p>The Code - What did we actually build?</p>

<p>  I realize, at this point, people might be asking themselves if its worth writing test features and step definitions for the little bit of code that is actually driven out by that process. Here are the step lines, minus their closing ‘end’, and the lines of code we generated as a result.</p>

<p>  Feature Step Lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">    Given /^I have </span><span class="s">2</span><span class="nf"> servers named ([\w.]+) and ([\w.]+)$/ do</span><span class="k"> |</span><span class="s">server1, server2</span><span class="k">|</span><span class="s"></span>
</span><span class='line'><span class="s">    Given /^([\w.]+) is accessible via the Event Socket$/ do</span><span class="k"> |</span><span class="s">es_server</span><span class="k">|</span><span class="s"></span>
</span><span class='line'><span class="s">    When /^I dial extension &quot;([^&quot;]*)&quot; on ([\w.]+)$/ do</span><span class="k"> |</span><span class="s">known_extension, server</span><span class="k">|</span><span class="s"></span>
</span><span class='line'><span class="s">    Then /^I should be connected to that extension$/ do</span>
</span><span class='line'><span class="s">    Then /^I should be able to terminate the call$/ do</span>
</span><span class='line'><span class="s">    When /^I dial unknown extension &quot;([^&quot;]*)&quot;$/ do</span><span class="k"> |</span><span class="s"> unknown_extension</span><span class="k">|</span><span class="s"></span>
</span><span class='line'><span class="s">    Then /^I should be notified the call failed$/ do</span>
</span><span class='line'><span class="s">    Then /^I should recieve call failure type &quot;([^&quot;]*)&quot;$/ do</span><span class="k"> |</span><span class="s">failure_type</span><span class="k">|</span><span class="s"></span>
</span></code></pre></td></tr></table></div></figure>


<p>  Code Lines Driven Out</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="vi">@server1</span><span class="p">,</span> <span class="vi">@server2</span> <span class="o">=</span> <span class="n">server1</span><span class="p">,</span> <span class="n">server2</span>
</span><span class='line'>  <span class="vi">@sock1</span> <span class="o">=</span> <span class="no">FSR</span><span class="o">::</span><span class="no">CommandSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="vi">@server1</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="mi">8021</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@played_files</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="vi">@sock2</span> <span class="o">=</span> <span class="no">FSR</span><span class="o">::</span><span class="no">CommandSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="vi">@server1</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@sock2</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="n">orig</span> <span class="o">=</span> <span class="vi">@sock2</span><span class="o">.</span><span class="n">originate</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="err">‘</span><span class="n">sofia</span><span class="o">/</span><span class="n">external</span><span class="o">/</span><span class="sx">%s@%s’ % [known_extension, @</span><span class="n">server2</span><span class="o">]</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="err">“</span><span class="o">&amp;</span><span class="n">transfer</span><span class="p">(</span><span class="err">‘</span><span class="mi">3000</span> <span class="no">XML</span> <span class="n">default</span><span class="err">’</span><span class="p">)</span><span class="err">”</span><span class="p">)</span>
</span><span class='line'>  <span class="n">orig</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="vi">@resp</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="ss">:api</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">fail</span> <span class="err">“</span><span class="no">Response</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">contain</span> <span class="no">OK</span><span class="err">”</span> <span class="k">unless</span> <span class="p">(</span><span class="vi">@resp</span><span class="o">[</span><span class="err">“</span><span class="n">body</span><span class="err">”</span><span class="o">].</span><span class="n">match</span><span class="sr"> /^\+OK \w{8}-(?:\w{4}-){3}\w{12}$/</span><span class="p">)</span>
</span><span class='line'>  <span class="n">message</span><span class="p">,</span> <span class="vi">@uuid</span> <span class="o">=</span> <span class="vi">@resp</span><span class="o">[</span><span class="err">“</span><span class="n">body</span><span class="err">”</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="err">“</span> <span class="err">“</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">fail</span> <span class="err">“</span><span class="no">No</span> <span class="no">UUID</span> <span class="n">found</span><span class="err">”</span> <span class="k">unless</span> <span class="n">message</span> <span class="o">==</span> <span class="err">‘</span><span class="o">+</span><span class="no">OK</span><span class="err">’</span>
</span><span class='line'>  <span class="vi">@uuid</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="n">resp</span> <span class="o">=</span> <span class="vi">@sock2</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="vi">@uuid</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="ss">:api</span><span class="p">)</span>
</span><span class='line'>  <span class="n">resp</span><span class="o">[</span><span class="err">“</span><span class="n">body</span><span class="err">”</span><span class="o">].</span><span class="n">should</span> <span class="n">match</span><span class="p">(</span><span class="sr">/^\+OK/</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="err"> </span> <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>  <span class="err">  </span><span class="k">break</span> <span class="k">unless</span> <span class="vi">@sock2</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="vi">@uuid</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@sock2</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="vi">@uuid</span> <span class="p">}</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="n">orig</span> <span class="o">=</span> <span class="vi">@sock2</span><span class="o">.</span><span class="n">originate</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="err">‘</span><span class="n">sofia</span><span class="o">/</span><span class="n">external</span><span class="o">/</span><span class="sx">%s@%s’ % [unknown_extension, @</span><span class="n">server2</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="n">endpoint</span><span class="p">:</span> <span class="err">“</span><span class="o">&amp;</span><span class="n">transfer</span><span class="p">(</span><span class="err">‘</span><span class="mi">3000</span> <span class="no">XML</span> <span class="n">default</span><span class="err">’</span><span class="p">)</span><span class="err">”</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@resp</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="ss">:api</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@resp</span><span class="o">[</span><span class="err">“</span><span class="n">body</span><span class="err">”</span><span class="o">].</span><span class="n">should</span> <span class="n">match</span><span class="p">(</span><span class="sr">/^-ERR/</span><span class="p">)</span>
</span><span class='line'>  <span class="n">status</span><span class="p">,</span> <span class="vi">@message</span> <span class="o">=</span> <span class="vi">@resp</span><span class="o">[</span><span class="err">“</span><span class="n">body</span><span class="err">”</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="err">“</span> <span class="err">“</span><span class="p">)</span>
</span><span class='line'>  <span class="n">status</span><span class="o">.</span><span class="n">should</span> <span class="n">match</span><span class="p">(</span><span class="err">‘</span><span class="o">-</span><span class="no">ERR</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@message</span><span class="o">.</span><span class="n">should</span> <span class="n">match</span><span class="p">(</span><span class="err">“</span><span class="c1">#{failure_type}”)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  <em><em>Total Step Lines: 8 | Total Code Lines: 25 | Code To Step Ratio: 3:1</em></em></p>

<p>  Not bad, we are averaging 3 lines of code being described by 1 step line. Or, if you prefer, we are averaging 3 lines of code to pass 1 step. To get back on the beaten path, we have completed the contents of 001 and proven out our Feature. So, far it looks like things are progressing right along.</p>

<p>  Our next article will add more to the pot because we’ll be adding in our first Listener class for handling events on the Listener we create and attach to the EventSocket. Anyone who wants a heads up can look over here.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Deryl R. Doucette</span></span>

      








  


<time datetime="2012-02-17T13:53:00-05:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rubyists.github.com/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature/" data-via="" data-counturl="http://rubyists.github.com/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/fs_specs/blog/2012/02/16/anatomy-of-an-fs-specs-feature-set-000-phone-infrastructure-feature/" title="Previous Post: Anatomy of an FS_SPECS Feature Set - 000_phone_infrastructure.feature">&laquo; Anatomy of an FS_SPECS Feature Set - 000_phone_infrastructure.feature</a>
      
      
        <a class="basic-alignment right" href="/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature/" title="Next Post: Interacting With Voicemail - 002_channel_can_interact_with_voicemail feature">Interacting With Voicemail - 002_channel_can_interact_with_voicemail feature &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature/">Interacting With Voicemail - 002_channel_can_interact_with_voicemail feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature/">Checking Out Extensions - 001_channel_can_dial_extensions feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/16/anatomy-of-an-fs-specs-feature-set-000-phone-infrastructure-feature/">Anatomy of an FS_SPECS Feature Set - 000_phone_infrastructure.feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/15/stage-fright-gone-brief-synopsis-of-goal/">Stage Fright Gone! Brief Synopsis of Goal</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/15/and-theyre-off-the-start-of-fs-specs/">And They're Off! - The start of FS_SPECS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/rubyists">@rubyists</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rubyists',
            count: 7,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/fs_specs/javascripts/github.js" type="text/javascript"> </script>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/114407361520857511779?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Deryl R. Doucette -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
