
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Interacting With Voicemail - 002_channel_can_interact_with_voicemail feature - FreeSWITCH And FreeSWITCHeR Ruby Library</title>
  <meta name="author" content="Deryl R. Doucette">

  
  <meta name="description" content="What Are We Doing Today? In this article, we’ll be discussing interacting with FreeSWITCH’s voicemail system using our &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rubyists.github.com/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature">
  <link href="/fs_specs/favicon.png" rel="icon">
  <link href="/fs_specs/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/fs_specs/javascripts/modernizr-2.0.js"></script>
  <script src="/fs_specs/javascripts/ender.js"></script>
  <script src="/fs_specs/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/fs_specs/atom.xml" rel="alternate" title="FreeSWITCH And FreeSWITCHeR Ruby Library" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h2><a href="/fs_specs/">FreeSWITCH And FreeSWITCHeR Ruby Library</a></h2>
  
    <h3>A Project for testing FreeSWITCH</h3>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/fs_specs/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rubyists.github.com/fs_specs" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/fs_specs/">Blog</a></li>
  <li><a href="/fs_specs/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Interacting With Voicemail - 002_channel_can_interact_with_voicemail Feature</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-22T19:00:00-05:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>What Are We Doing Today?</h3>

<p>In this article, we’ll be discussing interacting with FreeSWITCH’s voicemail system using our <a href="https://github.com/rubyists/fs_specs/blob/master/features/002_channel_can_interact_with_voicemail.feature">002_channel_can_interact_with_voicemail</a> feature. This Feature will require that we write our own custom Listener class that we attach to the EventSocket’s <em>on_event()</em> method using our own customized <em>handle_event()</em> method.</p>

<h3>Core Feature -  <a href="https://github.com/rubyists/fs_specs/blob/master/features/002_channel_can_interact_with_voicemail.feature">002_channel_can_interact_with_voicemail.feature</a></h3>

<p>Here is the Feature itself.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='Cucumber'><span class='line'><span class="nf">        Feature: Channel can interact with voicemail</span>
</span><span class='line'><span class="nf">     In order to utilize voicemail</span>
</span><span class='line'><span class="nf">     As a channel</span>
</span><span class='line'><span class="nf">     </span><span class="k">I </span><span class="nf">want to be able to log into, and use, the voicemail system</span>
</span><span class='line'>
</span><span class='line'><span class="nf">     </span><span class="k">Background:</span><span class="nf"></span>
</span><span class='line'><span class="k">      Given </span><span class="nf">I have </span><span class="s">2</span><span class="nf"> servers named blackbird.rubyists.com and tigershark.rubyists.com</span>
</span><span class='line'><span class="nf">     </span><span class="k">And </span><span class="nf">blackbird.rubyists.com is accessible via the Event Socket</span>
</span><span class='line'>
</span><span class='line'><span class="nf">     </span><span class="k">Scenario:</span><span class="nf"> Successfully log into voicemail using extension</span>
</span><span class='line'><span class="k">      And </span><span class="nf">I check voicemail for user </span><span class="s">1000</span><span class="nf"> with good password </span><span class="s">1000</span><span class="nf"></span>
</span><span class='line'><span class="nf">     </span><span class="k">Then </span><span class="nf">I should be logged into voicemail</span>
</span><span class='line'>
</span><span class='line'><span class="nf">     </span><span class="k">Scenario:</span><span class="nf"> Fail to log into voicemail using extension</span>
</span><span class='line'><span class="k">      And </span><span class="nf">I check voicemail for user </span><span class="s">1000</span><span class="nf"> with bad password </span><span class="s">1001</span><span class="nf"></span>
</span><span class='line'><span class="nf">     </span><span class="k">Then </span><span class="nf">I should be prompted to try again</span>
</span></code></pre></td></tr></table></div></figure>


<h3>What Exactly Does It Do? - <a href="https://github.com/rubyists/fs_specs/blob/master/features/step_definitions/steps.rb">steps.rb</a></h3>

<p>OK, here we go with the whirlwind ride of whats taking place within these Feature steps. The definitions of each of them are in the linked steps.rb file.</p>

<p>  As usual, we briefly describe in the Feature line, and expand upon immediately following, what the feature is for. We, again, hit the Background step which set up the connection for the remaining scenarios to use. That steps right into our first Scenario, “Successfully log into voicemail using extension”. In this Scenario, we check that we can log into voicemail for a specific extension, using the known password for that extension’s mailbox. This Scenario tests several sets of ideas.</p>

<p>It tests that we can:</p>

<pre><code>    * connect to the server
    * that it recognizes and sends us well formed data
    * that it recognizes well formed data we send it (e.g pressed keys)
    * that we recognize and identify the usage and response pattern freeswitch expects
    * that the expected pattern for interaction is seen in the data
    * that freeswitch responds correctly to our response. 
</code></pre>

<p>  The same is expected in the following Scenario, but for a negative test case. This ensures that we cover both states of recognition. Either we’re authenticated, or we’re not. If we are, use the system. If not, re-prompt and eventually drop.</p>

<p>Before we get into the specifics of the extension, let me explain what we’re going to be doing. We need a way to validate that we’re actually connecting to the voicemail system, and that we can react based upon the state changes we see as we move through the system. In this instance, freeswitch uses wav files to communicate. It plays specific wavs, in specific patterns and sub-patterns, that describe the various options available under the voicemail menu. We need some way to capture and use that information. Enter our custom class, the VmListener!</p>

<h3>The Code - What did we actually build? - <a href="https://github.com/rubyists/fs_specs/blob/master/features/step_definitions/vm_listener.rb">VmListener</a></h3>

<p>[This is where you describe the lines of code and what each one does, walking through the steps. The code from the step definitions go here.]</p>

<h3>The Round Up - And In Closing…</h3>

<p>Your closing remarks go here including any last minute i-just-thought-of-this</p>

<h3>Up Next - A Look Ahead..</h3>

<p>A hint on what the next article is going to be about.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Deryl R. Doucette</span></span>

      








  


<time datetime="2012-02-22T19:00:00-05:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rubyists.github.com/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature/" data-via="" data-counturl="http://rubyists.github.com/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature/" title="Previous Post: Checking Out Extensions - 001_channel_can_dial_extensions feature">&laquo; Checking Out Extensions - 001_channel_can_dial_extensions feature</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/22/interacting-with-voicemail-002-channel-can-interact-with-voicemail-feature/">Interacting With Voicemail - 002_channel_can_interact_with_voicemail feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/17/checking-out-extensions-001-channel-can-dial-extensions-feature/">Checking Out Extensions - 001_channel_can_dial_extensions feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/16/anatomy-of-an-fs-specs-feature-set-000-phone-infrastructure-feature/">Anatomy of an FS_SPECS Feature Set - 000_phone_infrastructure.feature</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/15/stage-fright-gone-brief-synopsis-of-goal/">Stage Fright Gone! Brief Synopsis of Goal</a>
      </li>
    
      <li class="post">
        <a href="/fs_specs/blog/2012/02/15/and-theyre-off-the-start-of-fs-specs/">And They're Off! - The start of FS_SPECS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/rubyists">@rubyists</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rubyists',
            count: 7,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/fs_specs/javascripts/github.js" type="text/javascript"> </script>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/114407361520857511779?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Deryl R. Doucette -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
